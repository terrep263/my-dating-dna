{
  "spec_version": "narrative-v1.4-enhanced-validation",
  "description": "Enhanced contract with detailed prompts, validation, and retry logic for 5+ sentence requirements",
  "generation_config": {
    "model": "gpt-4",
    "temperature": 0.7,
    "max_retries": 3,
    "timeout_ms": 30000
  },
  "validation_rules": {
    "global": {
      "min_sentences_per_item": 5,
      "max_sentences_per_item": 8,
      "min_words_per_sentence": 8,
      "sentence_delimiters": [".", "!", "?"],
      "required_elements": ["because", "therefore", "for example", "specifically"]
    },
    "couples": {
      "must_reference_both_partners": true,
      "must_include_compatibility_analysis": true,
      "must_provide_actionable_advice": true
    },
    "singles": {
      "must_reference_type_code": true,
      "must_include_practical_examples": true,
      "must_provide_specific_actions": true
    }
  },
  "prompt_templates": {
    "singles": {
      "relationship_approach": {
        "system_prompt": "You are a dating coach writing personalized relationship guidance. You MUST write exactly 5-7 complete sentences, each with at least 8 words.",
        "user_template": "Write about this person's relationship approach. Type: {type_code}, Strands: {strands}\n\nSTRICT FORMAT (5-7 sentences required):\n1. [Overall approach statement based on their type]\n2. [Specific behavioral example from their strand scores]\n3. [How this manifests in dating situations]\n4. [Practical advice for leveraging this approach]\n5. [Expected positive outcome]\n6-7. [Additional examples/details if needed]\n\nEach sentence must be at least 8 words long. Include specific examples.",
        "validation_prompt": "Previous response was too short ({actual_sentences} sentences). You MUST write exactly 5-7 sentences. Each sentence needs at least 8 words. Try again with more detail and examples:"
      },
      "dating_strategy": {
        "system_prompt": "You are a dating strategist creating personalized dating plans. You MUST write exactly 5-7 complete sentences, each with at least 8 words.",
        "user_template": "Create a dating strategy for Type: {type_code}, Strands: {strands}\n\nREQUIRED STRUCTURE (5-7 sentences):\n1. [Primary dating strategy based on type]\n2. [Specific platform/venue recommendations]\n3. [How their strands influence approach]\n4. [Concrete first date suggestions]\n5. [Timeline and frequency recommendations]\n6-7. [Additional tactical advice]\n\nInclude specific examples and actionable steps.",
        "validation_prompt": "That was only {actual_sentences} sentences. You need 5-7 sentences minimum. Add more specific examples and actionable details:"
      },
      "communication_style": {
        "system_prompt": "You are a communication expert writing personalized advice. You MUST write exactly 5-7 complete sentences, each with at least 8 words.",
        "user_template": "Analyze communication style for Type: {type_code}, Strands: {strands}\n\nMUST INCLUDE (5-7 sentences):\n1. [Core communication strength from type]\n2. [How strands influence messaging style]\n3. [Specific conversation examples]\n4. [Potential communication pitfalls to avoid]\n5. [Strategies for better connection]\n6-7. [Platform-specific advice (texting, calls, etc.)]\n\nProvide concrete examples and scenarios.",
        "validation_prompt": "Only {actual_sentences} sentences provided. Need 5-7 sentences with specific examples and advice:"
      }
    },
    "couples": {
      "compatibility_overview": {
        "system_prompt": "You are a couples therapist analyzing relationship dynamics. You MUST write exactly 5-7 complete sentences, each with at least 8 words.",
        "user_template": "Analyze compatibility between Partner A: {partner_a_type} ({partner_a_strands}) and Partner B: {partner_b_type} ({partner_b_strands})\n\nREQUIRED ANALYSIS (5-7 sentences):\n1. [Overall compatibility assessment]\n2. [Key areas of natural alignment]\n3. [Potential friction points from type differences]\n4. [How strand differences create balance/tension]\n5. [Relationship dynamic prediction]\n6-7. [Specific examples of how this plays out daily]\n\nInclude specific behavioral examples.",
        "validation_prompt": "Response too brief ({actual_sentences} sentences). Need 5-7 detailed sentences analyzing both partners' types and strands:"
      },
      "conflict_resolution": {
        "system_prompt": "You are a conflict resolution specialist for couples. You MUST write exactly 5-7 complete sentences, each with at least 8 words.",
        "user_template": "Create conflict resolution strategy for Partner A: {partner_a_type} and Partner B: {partner_b_type}\n\nMUST COVER (5-7 sentences):\n1. [How each type typically handles conflict]\n2. [Specific triggers based on their types]\n3. [Recommended de-escalation techniques]\n4. [Communication strategies that work for both]\n5. [How to leverage their different strengths]\n6-7. [Specific scenarios and solutions]\n\nProvide concrete examples and scripts.",
        "validation_prompt": "Need more detail - only {actual_sentences} sentences. Provide 5-7 sentences with specific conflict scenarios and solutions:"
      },
      "growth_path": {
        "system_prompt": "You are a relationship growth coach creating development plans. You MUST write exactly 5-7 complete sentences, each with at least 8 words.",
        "user_template": "Design growth path for Partner A: {partner_a_type} and Partner B: {partner_b_type}\n\nDEVELOPMENT PLAN (5-7 sentences):\n1. [Primary growth opportunity for the relationship]\n2. [How each partner can support the other's development]\n3. [Specific skills/behaviors to develop together]\n4. [Timeline and milestones for growth]\n5. [How to measure progress and celebrate wins]\n6-7. [Long-term relationship vision and goals]\n\nInclude specific activities and timelines.",
        "validation_prompt": "Too short at {actual_sentences} sentences. Need 5-7 sentences with specific growth activities and timelines:"
      },
      "joint_strengths": {
        "system_prompt": "You are a relationship expert identifying couple strengths. You MUST write exactly 5-7 complete sentences per strength, each with at least 8 words.",
        "user_template": "Identify joint strengths for Partner A: {partner_a_type} ({partner_a_strands}) and Partner B: {partner_b_type} ({partner_b_strands})\n\nFOR EACH STRENGTH (5-7 sentences):\n1. [Name and define the specific joint strength]\n2. [How this strength manifests in daily interactions]\n3. [Concrete example of this strength in action]\n4. [How both partners contribute to this strength]\n5. [Impact on relationship satisfaction and stability]\n6-7. [How
    }
  },
  "list_item_templates": {
    "singles": {
      "strengths": {
        "template": "Strength: {strength_name}\nExplanation (3-4 sentences): [How this strength manifests]. [Specific example in dating context]. [How to leverage it]. [Expected benefit].",
        "min_sentences": 3
      },
      "individual_strengths": {
        "template": "Individual Strength: {strength_name}\nDetailed Analysis (5-7 sentences): [Specific strength definition]. [How it shows up in dating]. [Real-world dating example]. [Connection to your type/strands]. [Impact on romantic success]. [Actionable leverage strategies]. [Expected relationship outcomes].",
        "min_sentences": 5
      },
      "growth_areas": {
        "template": "Growth Area: {area_name}\nDevelopment Plan (5-7 sentences): [Current challenge definition]. [How this limits dating success]. [Root cause analysis]. [Specific improvement strategy]. [Actionable development steps]. [Timeline and milestones]. [Success metrics and benefits].",
        "min_sentences": 5
      },
      "quick_wins": {
        "template": "Quick Win: {win_name}\nImplementation Guide (5-7 sentences): [Specific action to take]. [Why this works for your type]. [Step-by-step execution plan]. [Timeline (7-14 days)]. [Success measurement]. [Momentum building benefits]. [Obstacle prevention].",
        "min_sentences": 5
      },
      "affirmations": {
        "template": "Daily Affirmation: {affirmation_text}\nContext (2-3 sentences): [Why this matters for their type]. [When to use it]. [Expected mindset shift].",
        "min_sentences": 2
      }
    },
    "couples": {
      "shared_strengths": {
        "template": "Joint Strength: {strength_name}\nAnalysis (4-5 sentences): [How this shows up in your relationship]. [Specific example of this strength in action]. [How both partners contribute]. [Impact on relationship satisfaction]. [How to amplify this strength].",
        "min_sentences": 4
      },
      "joint_strengths": {
        "template": "Joint Strength: {strength_name}\nComprehensive Analysis (5-7 sentences): [Specific joint strength definition]. [Daily relationship manifestation]. [Concrete example in action]. [Both partners' contributions]. [Relationship satisfaction impact]. [Enhancement strategies]. [Long-term relationship benefits].",
        "min_sentences": 5
      },
      "shared_growth_areas": {
        "template": "Shared Growth Area: {area_name}\nMutual Development Strategy (5-7 sentences): [Shared challenge definition]. [Current relationship impact]. [How each type contributes to this need]. [Collaborative improvement plan]. [Joint action steps]. [Timeline and milestones]. [Relationship satisfaction benefits].",
        "min_sentences": 5
      },
      "growth_opportunities": {
        "template": "Growth Opportunity: {opportunity_name}\nDevelopment Strategy (4-5 sentences): [Current gap or challenge]. [How each partner can contribute to improvement]. [Specific actions to take together]. [Timeline for progress]. [How to measure success].",
        "min_sentences": 4
      },
      "quick_wins": {
        "template": "Couple Quick Win: {win_name}\nJoint Implementation Guide (5-7 sentences): [Specific joint action]. [Why this works for your combined types]. [Step-by-step execution together]. [Timeline (7-14 days)]. [Relationship improvement measurement]. [Momentum building for bigger changes]. [Mutual support through obstacles].",
        "min_sentences": 5
      },
      "joint_affirmations": {
        "template": "Couple Affirmation: {affirmation_text}\nPractice Guide (3 sentences): [When to use this together]. [How it strengthens your bond]. [Expected relationship benefit].",
        "min_sentences": 3
      }
    }
  },
  "action_plan_templates": {
    "A": {
      "template": "A - Immediate Action (48 hours): {action_description}\nImplementation (3 sentences): [Exactly what to do]. [When and where to do it]. [How to track completion].",
      "min_sentences": 3
    },
    "B": {
      "template": "B - Weekly Routine (7-day cycle): {routine_description}\nSchedule (3 sentences): [Specific days and times]. [What triggers this routine]. [How to maintain consistency].",
      "min_sentences": 3
    },
    "C": {
      "template": "C - Behavior Change (14-day focus): {behavior_description}\nProgress Plan (3 sentences): [Specific behavior to change]. [Daily practice method]. [How to measure improvement].",
      "min_sentences": 3
    },
    "D": {
      "template": "D - Leverage Change (30-day goal): {goal_description}\nSuccess Metrics (3 sentences): [Specific KPI to track]. [Target threshold to achieve]. [How this transforms your dating/relationship].",
      "min_sentences": 3
    }
  },
  "quality_control": {
    "pre_generation": {
      "validate_input_data": true,
      "ensure_type_codes_present": true,
      "verify_strand_scores": true
    },
    "post_generation": {
      "sentence_count_check": true,
      "word_count_per_sentence": true,
      "content_relevance_check": true,
      "actionability_verification": true
    },
    "retry_escalation": [
      {
        "attempt": 1,
        "action": "add_sentence_count_reminder"
      },
      {
        "attempt": 2,
        "action": "add_example_sentences"
      },
      {
        "attempt": 3,
        "action": "use_structured_template"
      }
    ]
  },
  "error_handling": {
    "insufficient_sentences": {
      "message": "Content must contain at least {min_sentences} sentences",
      "retry_prompt": "Previous response only had {actual_count} sentences. You MUST write at least {min_sentences} complete sentences. Add more detail, examples, and specific advice:"
    },
    "sentences_too_short": {
      "message": "Each sentence must contain at least {min_words} words",
      "retry_prompt": "Some sentences are too short. Each sentence needs at least {min_words} words. Expand with more detail:"
    },
    "missing_required_elements": {
      "message": "Content must include: {missing_elements}",
      "retry_prompt": "Your response is missing required elements: {missing_elements}. Please revise to include these:"
    }
  },
  "api_integration": {
    "endpoints": {
      "generate_section": "/api/generate-section",
      "validate_content": "/api/validate-content",
      "retry_generation": "/api/retry-generation"
    },
    "request_format": {
      "section_type": "string",
      "user_data": "object",
      "generation_options": "object"
    },
    "response_format": {
      "content": "string",
      "validation_results": "object",
      "retry_count": "number",
      "generation_metadata": "object"
    }
  },
  "implementation_notes": {
    "sentence_counting": "Split on [.!?] and filter sentences with <8 words",
    "prompt_injection": "Use {variable} replacement for user data",
    "validation_order": ["sentence_count", "word_count", "content_relevance", "actionability"],
    "retry_strategy": "Exponential backoff with enhanced prompts",
    "fallback_content": "Use template-based generation if AI fails after max retries"
  }
}